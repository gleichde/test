<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  
  <link rel="shortcut icon" href="../img/favicon.ico">
  <title>Basic Usage - MISCnn wiki</title>
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Source+Sans+Pro:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css">
  
  <script>
    // Current page data
    var mkdocs_page_name = "Basic Usage";
    var mkdocs_page_input_path = "Usage.md";
    var mkdocs_page_url = null;
  </script>
  
  <script src="../js/jquery-2.1.1.min.js" defer></script>
  <script src="../js/modernizr-2.8.3.min.js" defer></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script> 
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <a href="">
        <div class="miscnn-logo">
          <img src="https://raw.githubusercontent.com/gleichde/gleichde.github.io/master/logo.JPG" class="miscnn-logo-img">
          
        </div>
      </a>

      <div class="wy-side-nav-search">
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="..">Home</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Getting Started</span></p>
                <ul class="current">
                    <li class="toctree-l1"><a class="reference internal" href="../Home/">What is MIScnn?</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../Install/">Install</a>
                    </li>
                    <li class="toctree-l1 current"><a class="reference internal current" href="./">Basic Usage</a>
    <ul class="current">
    </ul>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../Tutorials/">Tutorials</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../Examples/">Examples</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Documentation - Core</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../Data-IO/">Data I/O</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../Preprocessor/">Preprocessor</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../Data-Augmentation/">Data Augmentation</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../Model/">Neural Network Model</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../Validation/">Validation Techniques</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Documentation - Interfaces</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../Architectures/">Architectures</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../Metrics/">Metrics</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../Subfunctions/">Subfunctions</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../IO-Interfaces/">I/O Interfaces</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Documentation - Extras</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../Sample/">Sample</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Other</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../Contribute/">How to Contribute</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../Credits/">Author and Contacts</a>
                    </li>
                </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="..">MISCnn wiki</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="..">Docs</a> &raquo;</li>
    
      
        
          <li>Getting Started &raquo;</li>
        
      
    
    <li>Basic Usage</li>
    <li class="wy-breadcrumbs-aside">
      
        <a href="https://github.com/frankkramer-lab/MIScnn/"
          class="icon icon-github"> Edit on GitHub</a>
      
    </li>
  </ul>
  
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h2 id="core-steps-of-the-miscnn-pipeline">Core steps of the MIScnn pipeline</h2>
<p>The MIScnn pipeline is represented by 4 core classes:</p>
<ul>
<li>Data I/O  </li>
<li>Data Augmentation (optional)</li>
<li>Preprocessor</li>
<li>Neural Network Model</li>
</ul>
<p>These classes handle all required steps for medical image segmentation and can be extensively customized. All classes, except the Data Augmentation class, use switchable interfaces which results into high configurability and offers simple integration of user-defined solutions.</p>
<p><img alt="alt-text" src="https://raw.githubusercontent.com/frankkramer-lab/MIScnn/master/docs/MIScnn.basic_usage.png" /></p>
<h2 id="workflow-of-miscnn">Workflow of MIScnn</h2>
<h4 id="import-the-miscnn-module">Import the MIScnn Module</h4>
<p>Before constructing our Medical Image Segmentation pipeline, we are going to import the MIScnn modules which will provide our core classes and functions.</p>
<pre><code class="python">import miscnn
</code></pre>

<h4 id="1-data-io">1) Data I/O</h4>
<p>The first step in the MIScnn pipeline is to establish the Data I/O class. The Data I/O handles the complete data loading of biomedical images, its segmentation and storage of predicted files, as well as temporary files like batches.</p>
<p>In order to open the MIScnn pipeline for a various data formats and structures, the data I/O class uses switchable I/O interfaces. It is possible to use already provided I/O interfaces with a fixed data structure or custom I/O interfaces for integration of your specific data structure into the MIScnn pipeline.</p>
<p>Before initializing an instance of the Data I/O class, we have to select an I/O interface. This interface have to load our data set into the MIScnn pipeline. In our example, we are using the KiTS19 data set which are kidney tumor CT scans encoded in the NIfTI format. Therefore, we call the provided NIfTI interface with a single channel (grayscale image) and 3 classes for the segmentation (background, kidney and tumor).</p>
<pre><code class="python">from miscnn.data_loading.interfaces.nifti_io import NIFTI_interface

interface = NIFTI_interface(pattern=&quot;case_000[0-9]*&quot;, channels=1, classes=3)
</code></pre>

<p>Afterwards, we can initialize the Data I/O class by passing our newly created interface and the path to the data set to the constructor.</p>
<pre><code class="python">data_path = &quot;/home/mudomini/projects/kits19/data/&quot;
data_io = miscnn.Data_IO(interface, data_path)
</code></pre>

<h4 id="2-preprocessor">2) Preprocessor</h4>
<p>Finally, we can initialize the Preprocessor class.</p>
<p>Therefore, we are passing our Data I/O Interface to the Preprocessor initialization. Additionally, we configure our Preprocessor to create batches on-the-fly (preprare_batches=False) by random cropping patches with size 80x160x160 out of the image.
Also a batch should contain 2 patches.</p>
<pre><code class="python"># Create and configure the Preprocessor class
pp = miscnn.Preprocessor(data_io, batch_size=2, analysis=&quot;patchwise-crop&quot;,
                         patch_shape=(80,160,160))
</code></pre>

<h6 id="specefic-data-augmentation">Specefic Data Augmentation</h6>
<p>If you want to specify the Data Augmentation, it is possible to configure the Data Augmentation class.
A Preprocessor object with default parameters automatically initialize a Data Augmentation class with default values, but here we initialize it by hand to illustrate the exact workflow of the MIScnn pipeline.</p>
<p>The parameters for the Data Augmentation configure which augmentation techniques should be applied to the data set.
In this case, we are using all possible augmentation techniques in order to run extensive data augmentation and avoid overfitting</p>
<pre><code class="python"># Create and configure the Data Augmentation class
data_aug = miscnn.Data_Augmentation(cycles=1, scaling=True, rotations=True,
                                    elastic_deform=True, mirror=True,
                                    brightness=True, contrast=True,
                                    gamma=True, gaussian_noise=True)

# Create and configure the Preprocessor class
pp = miscnn.Preprocessor(data_io, data_aug=data_aug, batch_size=2,
                        analysis=&quot;patchwise-crop&quot;, patch_shape=(80,160,160))
</code></pre>

<h4 id="3-neural-network-model">3) Neural Network Model</h4>
<p>Now it's time to initialize our final object: The Neural Network.</p>
<p>With the Neural Network class, we are able to run training and prediction operations. But before, we have to decide which Neural Network Architecture and Metric we want to use.<br />
In order to show the simplicity and performance of MIScnn, we stick with the simple 3D U-Net Architecture for our Neural Network without any special tricks or optimizations. For training, we are using the Soft Dice as loss.</p>
<pre><code class="python"># Import standard U-Net architecture and Soft Dice
from miscnn.neural_network.architecture.unet.standard import Architecture
from miscnn.neural_network.metrics import dice_soft
unet_standard = Architecture()

# Create a deep learning neural network model with a standard U-Net architecture
model = miscnn.Neural_Network(preprocessor=pp, architecture=unet_standard,
                              loss=dice_soft)
</code></pre>

<p>Now, let's run a model training on our data set for 500 epochs and, afterwards, predict the segmentation of a sample using the fitted model.</p>
<pre><code class="python"># Training the model with 80 samples for 500 epochs
sample_list = data_io.get_indiceslist()
model.train(sample_list[30:120], epochs=500)

# Predict the segmentation of 20 samples
model.predict(sample_list[0:30])
</code></pre>

<p>The predicted segmentation results will be passed to the Data I/O interface with the function save_prediction. The already implemented interfaces (like NiFTI interface) will store the predictions into files.</p>
<h4 id="4-results">4) Results</h4>
<p>We used our fitted U-Net model and successfully predicted a segmentation for our Kidney Tumor CT image.<br />
But how do we know, how good our segmentation is compared to the ground-truth?</p>
<p>We have the possibility to calculate several different scores (like the already implemented variants of the Dice Similarity Coefficient), but for simplicity, we want to compare it manually by eye. MIScnn provides a simple function to create comparison images (and for 3D data GIFs).</p>
<pre><code class="python"># Load the sample
sample = data_io.sample_loader(sample_list[24], load_seg=True, load_pred=True)
# Access image, truth and predicted segmentation data
img, seg, pred = sample.img_data, sample.seg_data, sample.pred_data
# Visualize the truth and prediction segmentation as a GIF
from miscnn.utils.visualizer import visualize_evaluation
visualize_evaluation(sample_list[24], img, seg, pred, &quot;plot_directory/&quot;)
</code></pre>

<p><img alt="alt-text" src="https://raw.githubusercontent.com/frankkramer-lab/MIScnn/master/docs/visualization.case_case_00024.gif" /></p>
<h4 id="complete-code">Complete Code</h4>
<pre><code class="python">import miscnn

# Initialize the NIfTI I/O interface and configure the images as one channel (grayscale)
# and three segmentation classes (background, kidney, tumor)
from miscnn.data_loading.interfaces.nifti_io import NIFTI_interface
interface = NIFTI_interface(pattern=&quot;case_000[0-9]*&quot;, channels=1,
                            classes=3)
# Create the Data I/O object
data_path = &quot;/home/mudomini/projects/kits19/data/&quot;
data_io = miscnn.Data_IO(interface, data_path)

# Create and configure the Data Augmentation class
data_aug = miscnn.Data_Augmentation(cycles=1, scaling=True, rotations=True,
                                    elastic_deform=True, mirror=True,
                                    brightness=True, contrast=True,
                                    gamma=True, gaussian_noise=True)

# Create and configure the Preprocessor class
pp = miscnn.Preprocessor(data_io, data_aug=data_aug, batch_size=2,
                         analysis=&quot;patchwise-crop&quot;, patch_shape=(80,160,160))

# Import standard U-Net architecture and Soft Dice
from miscnn.neural_network.architecture.unet.standard import Architecture
from miscnn.neural_network.metrics import dice_soft
unet_standard = Architecture()

# Create a deep learning neural network model with a standard U-Net architecture
model = miscnn.Neural_Network(preprocessor=pp, architecture=unet_standard,
                              loss=dice_soft)

# Training the model with 80 samples for 500 epochs
sample_list = data_io.get_indiceslist()
model.train(sample_list[0:80], epochs=500)

# Predict the segmentation of 20 samples
model.predict(sample_list[80:100])

# Load the sample
sample = data_io.sample_loader(sample_list[80], load_seg=True, load_pred=True)
# Access image, truth and predicted segmentation data
img, seg, pred = sample.img_data, sample.seg_data, sample.pred_data
# Visualize the truth and prediction segmentation as a GIF
from miscnn.utils.visualizer import visualize_evaluation
visualize_evaluation(sample_list[80], img, seg, pred, &quot;plot_directory/&quot;)
</code></pre>

<hr />
<p>For more detailed coding examples, check out the MIScnn wiki for
<a href="/Tutorials">tutorials</a> or <a href="/Examples">examples</a>.</p>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../Tutorials/" class="btn btn-neutral float-right" title="Tutorials">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../Install/" class="btn btn-neutral" title="Install"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>
  <p> <a href="/">Home</a> | <a href="/Install/">Installation</a> | <a href="/Usage/">Usage</a> | <a href="/Examples/">Examples</a> | <a href="/Credits/">Contact</a></p>
  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
          <a href="https://github.com/frankkramer-lab/MIScnn/" class="fa fa-github" style="float: left; color: #fcfcfc"> GitHub</a>
      
      
        <span><a href="../Install/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../Tutorials/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>
    <script>var base_url = '..';</script>
    <script src="../js/theme.js" defer></script>
      <script src="../search/main.js" defer></script>
    <script type="text/javascript" defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

</body>
</html>
