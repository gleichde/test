<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="../img/favicon.ico">
        <title>Neural Network Model - MISCnn wiki</title>
        <link href="../css/bootstrap-custom.min.css" rel="stylesheet">
        <link href="../css/font-awesome.min.css" rel="stylesheet">
        <link href="../css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css">
        <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
        <![endif]-->

        <script src="../js/jquery-1.10.2.min.js" defer></script>
        <script src="../js/bootstrap-3.0.3.min.js" defer></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
        <script>hljs.initHighlightingOnLoad();</script> 
    </head>

    <body>

        <div class="navbar navbar-default navbar-fixed-top" role="navigation">
            <div class="container">

                <!-- Collapsed navigation -->
                <div class="navbar-header">
                    <!-- Expander button -->
                    <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                        <span class="sr-only">Toggle navigation</span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button>
                    <a class="navbar-brand" href="..">MISCnn wiki</a>
                </div>

                <!-- Expanded navigation -->
                <div class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li >
                                <a href="../Home/">Home</a>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="dropdown-toggle" data-toggle="dropdown">Getting Started <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li >
    <a href="../Home/">What is MIScnn?</a>
</li>
                                    
<li >
    <a href="../Install/">Install</a>
</li>
                                    
<li >
    <a href="../Usage/">Basic Usage</a>
</li>
                                    
<li >
    <a href="../Tutorials/">Tutorials</a>
</li>
                                    
<li >
    <a href="../Examples/">Examples</a>
</li>
                                </ul>
                            </li>
                            <li class="dropdown active">
                                <a href="#" class="dropdown-toggle" data-toggle="dropdown">Documentation - Core <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li >
    <a href="../Data-IO/">Data I/O</a>
</li>
                                    
<li >
    <a href="../Preprocessor/">Preprocessor</a>
</li>
                                    
<li >
    <a href="../Data-Augmentation/">Data Augmentation</a>
</li>
                                    
<li class="active">
    <a href="./">Neural Network Model</a>
</li>
                                    
<li >
    <a href="../Validation/">Validation Techniques</a>
</li>
                                </ul>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="dropdown-toggle" data-toggle="dropdown">Documentation - Interfaces <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li >
    <a href="../Architectures/">Architectures</a>
</li>
                                    
<li >
    <a href="../Metrics/">Metrics</a>
</li>
                                    
<li >
    <a href="../Subfunctions/">Subfunctions</a>
</li>
                                    
<li >
    <a href="../IO-Interfaces/">I/O Interfaces</a>
</li>
                                </ul>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="dropdown-toggle" data-toggle="dropdown">Documentation - Extras <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li >
    <a href="../Sample/">Sample</a>
</li>
                                </ul>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="dropdown-toggle" data-toggle="dropdown">Other <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li >
    <a href="../Contribute/">How to Contribute</a>
</li>
                                    
<li >
    <a href="../Credits/">Author and Contacts</a>
</li>
                                </ul>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav navbar-right">
                        <li>
                            <a href="#" data-toggle="modal" data-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>
                            <li >
                                <a rel="next" href="../Data-Augmentation/">
                                    <i class="fa fa-arrow-left"></i> Previous
                                </a>
                            </li>
                            <li >
                                <a rel="prev" href="../Validation/">
                                    Next <i class="fa fa-arrow-right"></i>
                                </a>
                            </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
                <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
        <li class="main active"><a href="#methods">Methods</a></li>
            <li><a href="#initialization">Initialization</a></li>
            <li><a href="#train">train</a></li>
            <li><a href="#predict">predict</a></li>
            <li><a href="#evaluate">evaluate</a></li>
            <li><a href="#reset_weights">reset_weights</a></li>
            <li><a href="#dump">dump</a></li>
            <li><a href="#load">load</a></li>
    </ul>
</div></div>
                <div class="col-md-9" role="main">

<p>This class provides functionality for handling all model methods. This class runs the whole pipeline and uses a Preprocessor instance to obtain batches.</p>
<p>With an initialized Neural Network model instance, it is possible to run training, prediction and evaluations.</p>
<h2 id="methods">Methods</h2>
<h4 id="initialization">Initialization</h4>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="n">Neural_Network</span><span class="p">(</span><span class="n">preprocessor</span><span class="p">,</span> <span class="n">architecture</span><span class="o">=</span><span class="n">Architecture</span><span class="p">(),</span>
               <span class="n">loss</span><span class="o">=</span><span class="n">tversky_loss</span><span class="p">,</span> <span class="n">metrics</span><span class="o">=</span><span class="p">[</span><span class="n">dice_soft</span><span class="p">],</span>
               <span class="n">learninig_rate</span><span class="o">=</span><span class="mf">0.0001</span><span class="p">,</span> <span class="n">batch_queue_size</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
               <span class="n">workers</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">gpu_number</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</td></tr></table>

<p>Initialization function for creating a Neural Network (model) object.</p>
<p><strong>Arguments:</strong><br />
- <strong>preprocessor:</strong> Preprocessor class instance which provides the Neural Network with batches.
- <strong>architecture:</strong> Instance of a neural network model Architecture class instance. By default, a standard U-Net is used as Architecture.
- <strong>loss:</strong> The Metric function which is used as loss for training.
- <strong>metrics:</strong> List of one or multiple Metric Functions, which will be shown during training.
- <strong>learninig_rate:</strong> Learning rate in which weights of the neural network will be updated.
- <strong>batch_queue_size:</strong> The batch queue size is the number of previously prepared batches in the cache during runtime.
- <strong>workers:</strong> Number of workers/threads which preprocess batches during runtime.
- <strong>gpu_number:</strong> Number of GPUs, which will be used for training.</p>
<p><strong>Returns:</strong><br />
A Neural Network Model class object.</p>
<p><strong>Example:</strong>  </p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="n">model</span> <span class="o">=</span> <span class="n">miscnn</span><span class="o">.</span><span class="n">Neural_Network</span><span class="p">(</span><span class="n">preprocessor</span><span class="o">=</span><span class="n">pp</span><span class="p">)</span>
<span class="n">model</span><span class="o">.</span><span class="n">train</span><span class="p">(</span><span class="n">sample_list</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">100</span><span class="p">],</span> <span class="n">epochs</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>
</pre></div>
</td></tr></table>

<hr />
<h4 id="train">train</h4>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="n">train</span><span class="p">(</span><span class="n">sample_list</span><span class="p">,</span> <span class="n">epochs</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">iterations</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">callbacks</span><span class="o">=</span><span class="p">[])</span>
</pre></div>
</td></tr></table>

<p>Fitting function for the Neural Network model using the provided list of sample indices.</p>
<p><strong>Arguments:</strong>
- <strong>sample_list:</strong>  A list of sample indicies which will be used for training.
- <strong>epochs:</strong> Number of epochs. A single epoch is defined as one iteration through the complete data set.
- <strong>iterations:</strong> Number of iterations (batches) in a single epoch.
- <strong>callbacks:</strong> A list of Keras Callback classes for custom evaluation.</p>
<p><strong>Returns:</strong><br />
None.</p>
<p><strong>Example:</strong>  </p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="n">model</span><span class="o">.</span><span class="n">train</span><span class="p">(</span><span class="n">sample_list</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">100</span><span class="p">],</span> <span class="n">epochs</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>
</pre></div>
</td></tr></table>

<hr />
<h4 id="predict">predict</h4>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="n">predict</span><span class="p">(</span><span class="n">sample_list</span><span class="p">,</span> <span class="n">direct_output</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</td></tr></table>

<p>Prediction function for the Neural Network model. The fitted model will predict a segmentation for the provided list of sample indices.</p>
<p><strong>Arguments:</strong>
- <strong>sample_list:</strong>  A list of sample indicies for which a segmentation prediction will be computed.
- <strong>direct_output:</strong> Boolean, whether computed predictions will be output as the return of this function or if the predictions will be saved with the save_prediction method defined in the provided Data I/O interface.</p>
<p><strong>Returns:</strong><br />
None or a list of NumPy arrays containing predictions.</p>
<p><strong>Example:</strong>  </p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="c1"># Passing output of predictions into Data I/O interface - (intended for disk storage)</span>
<span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">sample_list</span><span class="p">[</span><span class="mi">100</span><span class="p">:</span><span class="mi">120</span><span class="p">])</span>

<span class="c1"># Direct output of predictions into variable (memory)</span>
<span class="n">predictions</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">sample_list</span><span class="p">[</span><span class="mi">100</span><span class="p">:</span><span class="mi">120</span><span class="p">],</span> <span class="n">direct_output</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</td></tr></table>

<hr />
<h4 id="evaluate">evaluate</h4>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="n">evaluate</span><span class="p">(</span><span class="n">training_samples</span><span class="p">,</span> <span class="n">validation_samples</span><span class="p">,</span> <span class="n">epochs</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span>
         <span class="n">iterations</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">callbacks</span><span class="o">=</span><span class="p">[]):</span>
</pre></div>
</td></tr></table>

<p>Evaluation function for the Neural Network model using the provided lists of sample indices for training and validation. It is also possible to pass custom Callback classes in order to obtain more information.</p>
<p><strong>Arguments:</strong>
- <strong>training_samples:</strong>  A list of sample indicies which will be used for training.
- <strong>validation_samples:</strong> A list of sample indicies which will be used for validation.
- <strong>epochs:</strong> Number of epochs. A single epoch is defined as one iteration through the complete data set.
- <strong>iterations:</strong> Number of iterations (batches) in a single epoch.
- <strong>callbacks:</strong> A list of Keras Callback classes for custom evaluation.</p>
<p><strong>Returns:</strong><br />
Keras history object (gathered fitting information and evaluation results of the validation).</p>
<p><strong>Example:</strong>  </p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="n">history</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">training_samples</span><span class="o">=</span><span class="n">sample_list</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">80</span><span class="p">],</span>
                         <span class="n">validation_samples</span><span class="o">=</span><span class="n">sample_list</span><span class="p">[</span><span class="mi">80</span><span class="p">:</span><span class="mi">100</span><span class="p">],</span>
                         <span class="n">iterations</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
</td></tr></table>

<hr />
<h4 id="reset_weights">reset_weights</h4>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="n">reset_weights</span><span class="p">()</span>
</pre></div>
</td></tr></table>

<p>Re-initialize weights of the neural network model.</p>
<p><strong>Arguments:</strong> None.</p>
<p><strong>Returns:</strong>  None.</p>
<p><strong>Example:</strong>  </p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="c1"># Fit weights of model</span>
<span class="n">model</span><span class="o">.</span><span class="n">train</span><span class="p">(</span><span class="n">sample_list</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">100</span><span class="p">],</span> <span class="n">epochs</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>
<span class="c1"># Throw fitted weights away to default weights</span>
<span class="n">model</span><span class="o">.</span><span class="n">reset_weights</span><span class="p">()</span>
</pre></div>
</td></tr></table>

<hr />
<h4 id="dump">dump</h4>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="n">dump</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
</pre></div>
</td></tr></table>

<p>Dump neural network model and its weights to file.</p>
<p><strong>Arguments:</strong>
- <strong>file_path:</strong> Output path, at which the model will be stored.</p>
<p><strong>Returns:</strong>  None.</p>
<p><strong>Example:</strong>  </p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="c1"># Fit weights of model</span>
<span class="n">model</span><span class="o">.</span><span class="n">train</span><span class="p">(</span><span class="n">sample_list</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">100</span><span class="p">],</span> <span class="n">epochs</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>
<span class="c1"># Save fitted model for reusability</span>
<span class="n">model</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="s2">&quot;my_model.hdf5&quot;</span><span class="p">)</span>
</pre></div>
</td></tr></table>

<hr />
<h4 id="load">load</h4>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="n">load</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="n">custom_objects</span><span class="o">=</span><span class="p">{}):</span>
</pre></div>
</td></tr></table>

<p>Load neural network model and its weights from a file. After loading, the model will be compiled.</p>
<p><strong>Arguments:</strong>
- <strong>file_path:</strong> Input path, from which the model will be loaded.
- <strong>custom_objects:</strong> Dictionary for custom objects for compiling (e.g. custom-defined metrics).</p>
<p><strong>Returns:</strong>  None.</p>
<p><strong>Example:</strong>  </p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="c1"># Save fitted model for reusability</span>
<span class="n">model</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s2">&quot;my_model.hdf5&quot;</span><span class="p">)</span>
<span class="c1"># Predict segmentation of some samples</span>
<span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">sample_list</span><span class="p">[</span><span class="mi">100</span><span class="p">:</span><span class="mi">120</span><span class="p">])</span>
</pre></div>
</td></tr></table>

<hr /></div>
        </div>

        <footer class="col-md-12">
            <hr>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script>
            var base_url = "..",
                shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
        </script>
        <script src="../js/base.js" defer></script>
        <script src="../search/main.js" defer></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="Search Modal" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                <h4 class="modal-title" id="exampleModalLabel">Search</h4>
            </div>
            <div class="modal-body">
                <p>
                    From here you can search these documents. Enter
                    your search terms below.
                </p>
                <form role="form">
                    <div class="form-group">
                        <input type="text" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="Keyboard Shortcuts Modal" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                <h4 class="modal-title" id="exampleModalLabel">Keyboard Shortcuts</h4>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
